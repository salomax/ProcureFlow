# Observability Stack
# Prometheus Configuration (Docker Compose Version)
global:
  # How often to scrape targets (every 30 seconds)
  scrape_interval: 30s

scrape_configs:
  # Monitor Prometheus itself - collects internal Prometheus server metrics
  - job_name: 'prometheus'
    static_configs:
      - targets: ['prometheus:9090']

  # Monitor the API service (Kotlin/Micronaut application)
  # HTTP request metrics, JVM metrics, database connections, business logic metrics
  - job_name: 'app'
    static_configs:
      - targets: ['app:8080']  # Docker service name (internal port)
    metrics_path: '/prometheus'  # Micronaut exposes prometheus endpoint directly

  # Monitor the API service (Kotlin/Micronaut application)
  # HTTP request metrics, JVM metrics, database connections, business logic metrics
  - job_name: 'assistant'
    static_configs:
      - targets: ['assistant:8080']  # Docker service name (internal port)
    metrics_path: '/prometheus'  # Micronaut exposes prometheus endpoint directly

  # Monitor PostgreSQL database
  # Metrics: connections, queries, locks, replication, database size
  - job_name: 'postgres'
    static_configs:
      - targets: ['postgres-exporter:9187']  # Docker service name

  # Monitor GraphQL Router (Apollo Router)
  # Metrics: GraphQL operations, response times, error rates, subgraph health
  - job_name: 'router'
    static_configs:
      - targets: ['router:9090']  # Docker service name
    metrics_path: '/metrics'
